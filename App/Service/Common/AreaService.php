<?phpnamespace App\Service\Common;use App\Model\Area\AreaModel;use EasySwoole\Component\Singleton;use EasySwoole\EasySwoole\Logger;class AreaService{    use Singleton;    public function areaName($data)    {        foreach ($data->toArray()['list'] as $k => $v) {            if (!empty($v['areaCode'])) {                $areaName = $this->areaCodeName($v['areaCode']);                $v['areaName'] = $areaName;            } else {                $v['areaName'] = '';            }        }        return $data;    }    public function weddingAreaName($data)    {        foreach ($data->toArray()['list'] as $k => $v) {            $v['todayVisitorCount'] = 0;            $v['guestCount'] = 0;            if (!empty($v['areaCode'])) {                $areaName = AreaService::getInstance()->areaCodeName($v['areaCode']);                $v['areaName'] = $areaName;            } else {                $v['areaName'] = '';            }        }    }    public function areaCodeName($areaCode)    {        if ($areaCode) {            //根据code获取地名            $areaInfo = $this->getNameByCode($areaCode);            //地名拼接成一条            $areaName = $this->spliceAreaName($areaInfo);        } else {            $areaName = '';        }        return $areaName;    }    //通过code获得上级的地名    public function getNameByCode($code)    {        $areaModel = new AreaModel();        $result = $areaModel->where('code', $code)->get();        $provinceId = $result->province ?? '';        $cityId = $result->city ?? '';        $areaId = $result->area ?? '';        $townId = $result->town ?? '';        $areaInfo = null;        $townInfo = null;        $provinceInfo = $areaModel->where('province', $provinceId)            ->where('city', 0)            ->where('area', 0)            ->where('town', 0)            ->field('code,name')            ->get();        $cityInfo = $areaModel->where('province', $provinceId)            ->where('city', $cityId)            ->where('area', 0)            ->where('town', 0)            ->field('code,name')            ->get();        if ($areaId != '0') {            $areaInfo = $areaModel->where('province', $provinceId)                ->where('city', $cityId)                ->where('area', $areaId)                ->where('town', 0)                ->field('code,name')                ->get();        }        if ($townId != '0') {            $townInfo = $areaModel->where('province', $provinceId)                ->where('city', $cityId)                ->where('area', $areaId)                ->where('town', $townId)                ->field('code,name')                ->get();        }        return ['provinceInfo' => $provinceInfo, 'cityInfo' => $cityInfo, 'areaInfo' => $areaInfo, 'townInfo' => $townInfo];    }    //将省市县地名拼接成一条    public function spliceAreaName($areaInfo)    {        if (empty($areaInfo)) {            return "";        }        if (!empty($areaInfo['provinceInfo']['name'])) {            $areaName = $areaInfo['provinceInfo']['name'];            if (!empty($areaInfo['cityInfo']['name'])){                $areaName = $areaInfo['provinceInfo']['name'] . $areaInfo['cityInfo']['name'];            }            //地名拼接成一条            if (!empty($areaInfo['areaInfo']['name'])) {                $areaName .= $areaInfo['areaInfo']['name'];                if (!empty($areaInfo['townInfo']['name'])) {                    $areaName .= $areaInfo['townInfo']['name'];                }            }            return $areaName;        }        return '';    }    public function getAreaData()    {        $model = new \App\Model\Area\AreaModel();        $data = [];        $pnList = $model            ->where('city', 0)            ->where('area', 0)            ->where('town', 0)->all();        /**         * @var $province \App\Model\Area\AreaModel         */        foreach ($pnList as $provinceKey => $province) {            $data[$provinceKey] = [                'text'  => $province->name,                'value' => $province->code            ];            $model = new \App\Model\Area\AreaModel();            $cityList = $model->where('province', $province->province)                ->where('city != 0')                ->where('area', 0)                ->where('town', 0)->all();            //如果是直辖市则特殊处理            $isMunicipality = 0;            if (empty($cityList)) {                $cityList = $model->where('province', $province->province)                    ->where('city', 0)                    ->where('area', 0)                    ->where('town', 0)->all();                $isMunicipality = 1;            }            /**             * @var $city \App\Model\Area\AreaModel             */            foreach ($cityList as $cityKey => $city) {                $data[$provinceKey]['children'][$cityKey] = [                    'text'  => $city->name,                    'value' => $city->code                ];                $model = new \App\Model\Area\AreaModel();                if ($isMunicipality == 0) {                    $model->where('city', $city->city);                }                $areaList = $model->where('province', $province->province)                    ->where('area != 0')                    ->where('town', 0)->all();                /**                 * @var $area \App\Model\Area\AreaModel                 */                foreach ($areaList as $areaKey => $area) {                    $data[$provinceKey]['children'][$cityKey]['children'][$areaKey] = [                        'text'  => $area->name,                        'value' => $area->code                    ];                }            }        }        return json_encode($data);    }}